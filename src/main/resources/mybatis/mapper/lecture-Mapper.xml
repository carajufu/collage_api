<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ac.collage_api.lecture.mapper.LectureMapper">

	<resultMap id="lectureMap" type="estblCourseVO">
	    <result property="estbllctreCode" column="ESTBLLCTRE_CODE"/>
		<result property="acqsPnt" column="ACQS_PNT"/>
		<result property="complSe" column="COMPL_SE"/>
		<result property="atnlcNmpr" column="ATNLC_NMPR"/>
		<result property="lctreUseLang" column="LCTRE_USE_LANG"/>
		<result property="evlMthd" column="EVL_MTHD"/>
		<result property="estblYear" column="ESTBL_YEAR"/>
		<result property="estblSemstr" column="ESTBL_SEMSTR"/>
		<result property="lctreCode" column="LCTRE_CODE"/>
		<result property="profsrNo" column="PROFSR_NO"/>
		<result property="lctrum" column="LCTRUM"/>
		<association property="timetable" javaType="lctreTimetableVO" resultMap="lctreTimetableMap"></association>
		<association property="allCourse" javaType="allCourseVO" resultMap="allCourseMap"></association>
		<association property="sklstf" javaType="sklstfVO" resultMap="sklstfMap"></association>
		<association property="profsr" javaType="profsrVO" resultMap="profsrMap"></association>
	</resultMap>
		
<!-- 		<result property="timetableNo" column="TIMETABLE_NO"/> -->
	<resultMap type="lctreTimetableVO" id="lctreTimetableMap">
		<result property="lctreDfk" column="LCTRE_DFK"/>
		<result property="beginTm" column="BEGIN_TM"/>
		<result property="endTm" column="END_TM"/>
	</resultMap>
	
	<resultMap type="allCourseVO" id="allCourseMap">
		<result property="lctreNm" column="LCTRE_NM"/>
	</resultMap>
	
	<resultMap type="sklstfVO" id="sklstfMap">
		<result property="sklstfNm" column="SKLSTF_NM"/>
		<result property="cttpc" column="CTTPC"/>
	</resultMap>
		
	<resultMap type="profsrVO" id="profsrMap">
		<result property="labrumLc" column="LABRUM_LC"/>
	</resultMap>


	<!-- 전체 강의 조회 -->
	<select id="list" resultMap="lectureMap">
		select E.ESTBLLCTRE_CODE, E.ACQS_PNT, E.COMPL_SE, A.LCTRE_NM, E.ATNLC_NMPR, E.LCTRE_USE_LANG, 
		       E.EVL_MTHD, E.ESTBL_SEMSTR, E.LCTRE_CODE, E.PROFSR_NO, E.LCTRUM,
		       A.LCTRE_CODE, A.OPER_AT,
		       L.TIMETABLE_NO, L.ESTBLLCTRE_CODE, L.LCTRE_DFK, L.BEGIN_TM, L.END_TM
		       ,S.SKLSTF_NM
		from   ESTBL_COURSE E
		inner join ALL_COURSE A on (E.LCTRE_CODE = A.LCTRE_CODE)
		inner join LCTRE_TIMETABLE L on (E.ESTBLLCTRE_CODE = L.ESTBLLCTRE_CODE)
		inner join PROFSR P on (E.PROFSR_NO = P.PROFSR_NO)
		inner join SKLSTF S on (S.SKLSTF_ID = P.SKLSTF_ID)
		
		<where>
			<if test="keyword != null and keyword != ''">
				and (lctre_nm like '%' || #{keyword} || '%')
			</if>
			<if test="complSe != null and complSe != ''">
				and compl_se = #{complSe}
			</if>
		</where>
	</select>
	
	
	<!-- 담당 강의 목록 조회(교수) -->
	<select id="mylist" resultMap="lectureMap">
		select E.ESTBLLCTRE_CODE, E.ACQS_PNT, E.COMPL_SE, A.LCTRE_NM, E.ATNLC_NMPR, E.LCTRE_USE_LANG, 
		       E.EVL_MTHD, E.ESTBL_SEMSTR, E.LCTRE_CODE, E.PROFSR_NO, E.LCTRUM,
		       A.LCTRE_CODE, A.OPER_AT,
		       L.TIMETABLE_NO, L.ESTBLLCTRE_CODE, L.LCTRE_DFK, L.BEGIN_TM, L.END_TM
		       ,S.SKLSTF_NM
		from   estbl_course E
		inner join all_course A on (E.lctre_code = A.lctre_code)
		inner join lctre_timetable L on (E.ESTBLLCTRE_CODE = L.ESTBLLCTRE_CODE)
		inner join profsr P on (E.profsr_no = P.profsr_no)
		inner join sklstf S on (S.sklstf_id = P.sklstf_id)
<!-- 		where E.profsr_no = #{profsrNo} -->
		<where>
			<if test="keyword != null and keyword != ''">
				and (lctre_nm like '%' || #{keyword} || '%')
			</if>
			<if test="complSe != null and complSe != ''">
				and compl_se = #{complSe}
			</if>
		</where>
	</select>
	
	<select id="detail" parameterType="estblCourseVO" resultMap="lectureMap">
		select E.ESTBLLCTRE_CODE, E.LCTRE_CODE, E.PROFSR_NO, E.FILE_GROUP_NO, E.ACQS_PNT, 
		       E.LCTRUM, E.COMPL_SE, E.ATNLC_NMPR, E.LCTRE_USE_LANG, E.EVL_MTHD, 
		       E.ATEND_SCORE_REFLCT_RATE, E.TASK_SCORE_REFLCT_RATE, E.MIDDLE_TEST_SCORE_REFLCT_RATE, 
		       E.TRMEND_TEST_SCORE_REFLCT_RATE, E.ESTBL_YEAR, E.ESTBL_SEMSTR,
		       A.LCTRE_NM, A.OPER_AT,
		       L.TIMETABLE_NO, L.ESTBLLCTRE_CODE, L.LCTRE_DFK, L.BEGIN_TM, L.END_TM,
		       P.LABRUM_LC, S.SKLSTF_NM, S.CTTPC
		from   ESTBL_COURSE E
		inner join ALL_COURSE A on (E.LCTRE_CODE = A.LCTRE_CODE)
		inner join LCTRE_TIMETABLE L on (E.ESTBLLCTRE_CODE = L.ESTBLLCTRE_CODE)
		inner join PROFSR P on (E.PROFSR_NO = P.PROFSR_NO)
		inner join SKLSTF S on (S.SKLSTF_ID = P.SKLSTF_ID)
		where E.ESTBLLCTRE_CODE = #{estbllctreCode}
	</select>
	
	<select id="detailAjax" parameterType="estblCourseVO" resultMap="lectureMap">
		select E.ESTBLLCTRE_CODE, E.LCTRE_CODE, E.PROFSR_NO, E.FILE_GROUP_NO, E.ACQS_PNT, 
		       E.LCTRUM, E.COMPL_SE, E.ATNLC_NMPR, E.LCTRE_USE_LANG, E.EVL_MTHD, 
		       E.ATEND_SCORE_REFLCT_RATE, E.TASK_SCORE_REFLCT_RATE, E.MIDDLE_TEST_SCORE_REFLCT_RATE, 
		       E.TRMEND_TEST_SCORE_REFLCT_RATE, E.ESTBL_YEAR, E.ESTBL_SEMSTR,
		       A.LCTRE_NM, A.OPER_AT,
		       L.TIMETABLE_NO, L.ESTBLLCTRE_CODE, L.LCTRE_DFK, L.BEGIN_TM, L.END_TM,
		       P.LABRUM_LC, S.SKLSTF_NM, S.CTTPC
		from   ESTBL_COURSE E
		inner join ALL_COURSE A on (E.LCTRE_CODE = A.LCTRE_CODE)
		inner join LCTRE_TIMETABLE L on (E.ESTBLLCTRE_CODE = L.ESTBLLCTRE_CODE)
		inner join PROFSR P on (E.PROFSR_NO = P.PROFSR_NO)
		inner join SKLSTF S on (S.SKLSTF_ID = P.SKLSTF_ID)
		where E.ESTBLLCTRE_CODE = #{estbllctreCode}
	</select>
	
	<update id="editEstbl" parameterType="estblCourseVO">
		update ESTBL_COURSE
		set	   LCTRUM = #{lctrum},
			   EVL_MTHD = #{evlMthd}
		where  ESTBLLCTRE_CODE = #{estbllctreCode}
	</update>
	
	<update id="editTimetable" parameterType="lctreTimetableVO">
		update LCTRE_TIMETABLE
		set	   LCTRE_DFK = #{lctreDfk},
			   BEGIN_TM = #{beginTm},
			   END_TM = #{endTm}
		where  ESTBLLCTRE_CODE = #{estbllctreCode}
	</update>
	
	
</mapper>