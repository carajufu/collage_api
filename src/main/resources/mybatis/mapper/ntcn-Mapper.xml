<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ac.collage_api.ntcn.mapper.NtcnMapper">

	<!-- //알림 저장
	int insertNtcn(NtcnVO ntcnVO); -->
	<insert id="insertNtcn">
		<selectKey resultType="int" order="BEFORE" keyProperty="ntcnNo" >
			SELECT NVL(MAX(NTCN_NO),0)+1
			FROM NTCN
		</selectKey>
		INSERT INTO NTCN (
				NTCN_NO, ACNT_ID, NTCN_CN, NTCN_ITNADR, SENDER, CNFIRM_AT, REGIST_DT)
		VALUES(#{ntcnNo},#{acntId},#{ntcnCn},#{ntcnItnadr},#{sender},'N',SYSDATE)
	</insert>

	<!-- //안 읽은 알림 가져오기
	List<NtcnVO> selectUnreadNtcnList(String acntId); -->
	<select id="selectUnreadNtcnList" parameterType="string">
		SELECT NTCN_NO, ACNT_ID, NTCN_CN, NTCN_ITNADR, SENDER, CNFIRM_AT, REGIST_DT
		FROM NTCN
		WHERE 1=1
		  AND ACNT_ID = #{acntId}
		  AND CNFIRM_AT = 'N'
		ORDER BY NTCN_NO
	</select>

	<!-- //읽었을때 cnfirmAt 값 변경
	int updateNtcnCnfirmAt(int ntcnNo); -->
	<update id="updateNtcnCnfirmAt" parameterType="int">
		UPDATE NTCN
		SET	CNFIRM_AT = 'Y'
		WHERE NTCN_NO = #{ntcnNo}
	</update>

</mapper>